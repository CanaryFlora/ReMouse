[gd_scene load_steps=25 format=3 uid="uid://day2gigkbrlvw"]

[ext_resource type="Script" path="res://entities/player/player.gd" id="1_wgmn8"]
[ext_resource type="Texture2D" uid="uid://bjot8y002imec" path="res://assets/player/mouse_body.png" id="1_yrglv"]
[ext_resource type="Texture2D" uid="uid://b70nl8b2rcvd3" path="res://assets/player/mouse_hand_black.png" id="2_c64f1"]
[ext_resource type="Texture2D" uid="uid://bk1lqugt2cr7x" path="res://assets/player/mouse_hand_white.png" id="3_n143m"]
[ext_resource type="Script" path="res://inventory/nodes/inventory_component.gd" id="4_itinh"]
[ext_resource type="Script" path="res://inventory/resources/inventory_slot_resource.gd" id="5_7l38g"]
[ext_resource type="Script" path="res://inventory/nodes/inventory_display_component.gd" id="6_2kno8"]
[ext_resource type="PackedScene" uid="uid://cyadkk1ro06x1" path="res://inventory/inventory_slot_scene.tscn" id="7_gpea6"]
[ext_resource type="PackedScene" uid="uid://b1rmquuux5hj6" path="res://inventory/hotbar_container.tscn" id="8_w1kg7"]
[ext_resource type="PackedScene" uid="uid://cm1s1o27qbnj" path="res://inventory/inventory_container.tscn" id="9_e2b68"]
[ext_resource type="Script" path="res://inventory/resources/inventory_use_component.gd" id="10_nlovx"]
[ext_resource type="Script" path="res://components/player_control_movement_component.gd" id="11_htuck"]
[ext_resource type="Script" path="res://components/entity_variable_stats/entity_variable_stats_component.gd" id="12_8d0qd"]
[ext_resource type="Script" path="res://components/entity_variable_stats/stat_properties.gd" id="13_4n000"]
[ext_resource type="Texture2D" uid="uid://dd8wko1sps8vm" path="res://health bar.png" id="15_lnlya"]

[sub_resource type="CircleShape2D" id="CircleShape2D_e8u32"]
radius = 10.0499

[sub_resource type="RectangleShape2D" id="RectangleShape2D_kd5wk"]
size = Vector2(49, 116)

[sub_resource type="Resource" id="Resource_whx7i"]
script = ExtResource("5_7l38g")

[sub_resource type="Resource" id="Resource_xuwlo"]
script = ExtResource("13_4n000")
StatName = &"Health"
MinValue = 0.0
MaxValue = 80.0
StartingValue = 0.0
Decay = 0.0
Gain = 1.0
IncrementRate = 0.1
ProgressBarNodePath = NodePath("../StatUI/TextureProgressBar")

[sub_resource type="GDScript" id="GDScript_ah83e"]
script/source = "class_name EntityEffectsDisplayComponent
## A specialized EntityEffectsComponent that displays status effects on screen according to its properties.
extends EntityEffectsComponent

## The node that the EffectContainer will be added as a child of.
@export var EffectUINode : Node
## The scene which effect display nodes will be added as a child of. An EffectContainerScene must have a NodePath property pointing to a GridContainer.
@export var EffectContainerScene : PackedScene
## The scene that will be the EffectScene's parent in the EffectContainerScene.
@export var EffectParentScene : PackedScene

var EffectContainer : Node


func setup_container():
	EffectContainer = EffectContainerScene.instantiate()
	EffectUINode.add_child(EffectContainer)


func _ready():
	setup_container()
	self.effect_started.connect(setup_effect_display)
	self.effect_ended.connect(remove_effect_display)


func _physics_process(delta):
	for effect in EffectsArray:
		if effect.EffectTimer != null and effect.GameEffectScene != null:
			if effect.EffectDisplayMode == \"ProgressBar\":
				effect.GameEffectScene.value = effect.EffectTimer.wait_time
				print(effect.EffectTimer)
				print(effect.EffectTimer.wait_time)
#				print(effect.GameEffectScene.value)
			elif effect.EffectDisplayMode == \"TimeDisplay\":
				effect.GameEffectScene.get_node(\"TimeDisplay\").text = str(effect.Duration)


func setup_effect_display(effect : EffectProperties):
	effect.EffectTimer.stop()
	var EffectParent = EffectParentScene.instantiate()
	var EffectScene : Node = effect.EffectScene.instantiate()
	effect.GameEffectScene = EffectScene
	EffectContainer.add_child(EffectParent)
	EffectParent.add_child(EffectContainer)
	EffectParent.add_child(EffectScene)
	if effect.EffectDisplayMode == \"ProgressBar\":
		EffectScene.max_value = effect.Duration
		EffectScene.value = effect.Duration
		if effect.DurationLimit:
			EffectScene.max_value = effect.MaxDuration
			EffectScene.min_value = effect.MinDuration
	elif effect.EffectDisplayMode == \"TimeDisplay\":
		var TimeDisplay : Timer = EffectScene.get_node(\"TimeDisplay\")
		TimeDisplay.text = str(effect.Duration)


func remove_effect_display(effect : EffectProperties):
	effect.GameEffectScene.queue_free()
	effect.GameEffectScene = null
"

[sub_resource type="PackedScene" id="PackedScene_bxxsq"]
_bundled = {
"conn_count": 0,
"conns": PackedInt32Array(),
"editable_instances": [],
"names": PackedStringArray("PanelContainer", "anchors_preset", "anchor_left", "anchor_top", "anchor_right", "anchor_bottom", "grow_horizontal", "grow_vertical", "EffectGridContainer", "layout_mode", "columns", "metadata/EffectGridContainer", "GridContainer"),
"node_count": 2,
"node_paths": [],
"nodes": PackedInt32Array(-1, -1, 0, 0, -1, 7, 1, 0, 2, 1, 3, 2, 4, 1, 5, 2, 6, 3, 7, 4, 0, 0, 0, 12, 8, -1, 3, 9, 3, 10, 5, 11, 6, 0),
"variants": [7, 0.5, 1.0, 2, 0, 6, NodePath(".")],
"version": 3
}

[sub_resource type="StyleBoxFlat" id="StyleBoxFlat_elvc5"]
bg_color = Color(0.184314, 0.184314, 0.184314, 1)
corner_radius_top_left = 20
corner_radius_top_right = 20
corner_radius_bottom_right = 20
corner_radius_bottom_left = 20

[sub_resource type="Theme" id="Theme_0pm0f"]
MarginContainer/constants/margin_bottom = 25
MarginContainer/constants/margin_left = 25
MarginContainer/constants/margin_right = 25
MarginContainer/constants/margin_top = 25
PanelContainer/styles/panel = SubResource("StyleBoxFlat_elvc5")

[sub_resource type="PackedScene" id="PackedScene_gfxm3"]
_bundled = {
"conn_count": 0,
"conns": PackedInt32Array(),
"editable_instances": [],
"names": PackedStringArray("EffectParentScene", "anchors_preset", "anchor_right", "anchor_bottom", "grow_horizontal", "grow_vertical", "theme", "PanelContainer", "MarginContainer", "layout_mode"),
"node_count": 2,
"node_paths": [],
"nodes": PackedInt32Array(-1, -1, 7, 0, -1, 6, 1, 0, 2, 1, 3, 1, 4, 2, 5, 2, 6, 3, 0, 0, 0, 8, 8, -1, 2, 9, 2, 6, 3, 0),
"variants": [15, 1.0, 2, SubResource("Theme_0pm0f")],
"version": 3
}

[node name="Mouse" type="CharacterBody2D"]
scale = Vector2(0.9, 1)
collision_layer = 28
collision_mask = 28
script = ExtResource("1_wgmn8")
AbilityEnabled = true
EntityCollisionNode = Object(CollisionPolygon2D,"_import_path":NodePath(""),"unique_name_in_owner":false,"process_mode":0,"process_priority":0,"process_physics_priority":0,"process_thread_group":0,"editor_description":"","visible":true,"modulate":Color(1, 1, 1, 1),"self_modulate":Color(1, 1, 1, 1),"show_behind_parent":false,"top_level":false,"light_mask":1,"visibility_layer":1,"z_index":0,"z_as_relative":true,"y_sort_enabled":false,"texture_filter":0,"texture_repeat":0,"material":null,"use_parent_material":false,"position":Vector2(0, 0),"rotation":0.0,"scale":Vector2(1, 1),"skew":0.0,"build_mode":0,"polygon":PackedVector2Array(53, 24, 54, 13, 51, 1, 43, -21, 32, -35, 17, -44, -20, -44, -32, -35, -42, -23, -50, -9, -54, 5, -55, 18, -52, 31, -47, 43, -43, 52, -40, 59, -37, 64, -15, 92, 0, 100, 12, 93, 27, 76, 36, 62, 42, 52, 48, 42, 51, 34),"disabled":false,"one_way_collision":false,"one_way_collision_margin":1.0,"script":null)

DashHitbox = Object(CollisionShape2D,"_import_path":NodePath(""),"unique_name_in_owner":false,"process_mode":0,"process_priority":0,"process_physics_priority":0,"process_thread_group":0,"editor_description":"","visible":true,"modulate":Color(1, 1, 1, 1),"self_modulate":Color(1, 1, 1, 1),"show_behind_parent":false,"top_level":false,"light_mask":1,"visibility_layer":1,"z_index":0,"z_as_relative":true,"y_sort_enabled":false,"texture_filter":0,"texture_repeat":0,"material":null,"use_parent_material":false,"position":Vector2(-0.5, 20),"rotation":0.0,"scale":Vector2(1, 1),"skew":0.0,"shape":SubResource("RectangleShape2D_kd5wk"),"disabled":true,"one_way_collision":false,"one_way_collision_margin":1.0,"script":null)

Inventory = Object(Node,"_import_path":NodePath(""),"unique_name_in_owner":false,"process_mode":0,"process_prio